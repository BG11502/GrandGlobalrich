<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body { background-color: #f8f9fa; }
    .card { border-radius: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .table tfoot td { font-weight: bold; background-color: #f1f1f1; }
    .btn-icon { display: inline-flex; align-items: center; gap: 0.4em; }
    .btn-outline-secondary:hover { background-color: #e2e6ea; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
<div class="container py-4">

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå -->
  <div class="d-flex justify-content-between mb-4">
    <a href="index.html" class="btn btn-outline-primary btn-icon">
      <i class="bi bi-house-door"></i> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
    </a>
    <a href="‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î.html" class="btn btn-outline-secondary btn-icon">
      <i class="bi bi-graph-up-arrow"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î
    </a>
  </div>

  <h2 class="text-center mb-4 text-primary">üìÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</h2>

  <!-- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ -->
  <div class="card p-3 mb-4">
    <h5 class="mb-3">üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h5>
    <div class="input-group">
      <input type="text" id="newOwner" class="form-control" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà" />
      <button class="btn btn-success" onclick="addOwner()">
        <i class="bi bi-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°
      </button>
    </div>
    <div id="ownerList" class="d-flex flex-wrap gap-2 mt-3"></div>
  </div>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <div class="card p-4 mb-4">
    <form id="adForm">
      <input type="hidden" id="editIndex" />
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
          <input type="date" id="date" class="form-control" required />
        </div>
        <div class="col-md-3">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
          <input type="text" id="accountName" class="form-control" required />
        </div>
        <div class="col-md-3">
          <label class="form-label">ID ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
          <input type="text" id="accountId" class="form-control" required />
        </div>
        <div class="col-md-3">
          <label class="form-label">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
          <select id="owner" class="form-select" required></select>
        </div>
        <div class="col-md-3">
          <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
          <select id="status" class="form-select">
            <option value="‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</option>
            <option value="‡∏£‡∏∞‡∏á‡∏±‡∏ö">‡∏£‡∏∞‡∏á‡∏±‡∏ö</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label>
          <input type="number" id="spendTotal" class="form-control" step="0.01" />
        </div>
        <div class="col-md-3">
          <label class="form-label">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏ã‡∏∑‡πâ‡∏≠</label>
          <input type="number" id="costPerPurchase" class="form-control" step="0.01" />
        </div>
        <div class="col-md-3">
          <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ã‡∏∑‡πâ‡∏≠</label>
          <input type="number" id="purchases" class="form-control" />
        </div>
        <div class="col-md-3">
          <label class="form-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</label>
          <input type="number" id="revenue" class="form-control" step="0.01" />
        </div>
        <div class="col-md-3">
          <label class="form-label">ROAS</label>
          <input type="number" id="roas" class="form-control" step="0.01" />
        </div>
      </div>
      <div class="mt-4 text-end">
        <button type="submit" class="btn btn-primary btn-lg">
          <i class="bi bi-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        </button>
      </div>
    </form>
  </div>

  <!-- ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á -->
  <div class="mb-3 d-flex justify-content-between align-items-center">
    <label class="form-label">‡∏Å‡∏£‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
    <select id="filterOwner" class="form-select w-auto"></select>
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á -->
  <div class="card p-4">
    <h5 class="text-secondary mb-3"><i class="bi bi-clock-history"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h5>
    <div class="table-responsive">
      <table class="table table-bordered table-striped text-center align-middle">
        <thead class="table-light">
          <tr>
            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
            <th>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th>
            <th>ID</th>
            <th>‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</th>
            <th>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏ã‡∏∑‡πâ‡∏≠</th>
            <th>‡∏ã‡∏∑‡πâ‡∏≠</th>
            <th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
            <th>ROAS</th>
            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="historyBody"></tbody>
        <tfoot>
          <tr>
            <td colspan="5">‡∏£‡∏ß‡∏°</td>
            <td id="sumSpend">0.00</td>
            <td id="avgCost">0.00</td>
            <td id="sumPurchase">0</td>
            <td id="sumRevenue">0.00</td>
            <td colspan="2"></td>
          </tr>
        </tfoot>
      </table>
    </div>
    <div class="mt-3 text-end">
      <button class="btn btn-secondary btn-icon" onclick="undoDelete()" id="undoBtn" style="display:none;">
        <i class="bi bi-arrow-counterclockwise"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏ö
      </button>
    </div>
  </div>
</div>

<script>
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Supabase client ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  const supabase = supabase.createClient(
    "https://vzxttbvwukpsxqdaulvo.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ6eHR0YnZ3dWtwc3hxZGF1bHZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5MTI2MzIsImV4cCI6MjA2NzQ4ODYzMn0.s05eiK-WITEq_uEVH4zXNkPG0KUk4Fmv4Yo5jZizm2U"
  );

  let adHistory = [];
  let ownerList = [];
  let lastDeleted = null;

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏à‡∏≤‡∏Å Supabase (‡∏î‡∏∂‡∏á id ‡∏î‡πâ‡∏ß‡∏¢)
  async function fetchOwnerList() {
    const { data, error } = await supabase.from("ad_owners").select("id, name").order("name");
    if (error) {
      console.error("Error fetching owners:", error);
      return;
    }
    ownerList = data; // [{id, name}, ...]
    renderOwnerSelect();
  }

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏à‡∏≤‡∏Å Supabase
  async function fetchAdHistory() {
    let { data, error } = await supabase.from("ad_history").select("*").order("date", { ascending: true });
    if (error) {
      console.error("Error fetching ad history:", error);
      return;
    }
    adHistory = data;
    renderTable();
  }

  // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏ô select ‡πÅ‡∏•‡∏∞ list
  function renderOwnerSelect() {
    const ownerSelect = document.getElementById("owner");
    const filterOwner = document.getElementById("filterOwner");
    ownerSelect.innerHTML = `<option disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>`;
    filterOwner.innerHTML = `<option value="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>`;

    ownerList.forEach(({id, name}) => {
      ownerSelect.innerHTML += `<option value="${name}">${name}</option>`;
      filterOwner.innerHTML += `<option value="${name}">${name}</option>`;
    });

    // ‡πÅ‡∏™‡∏î‡∏á list ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
    const ownerListDiv = document.getElementById("ownerList");
    ownerListDiv.innerHTML = "";
    ownerList.forEach(({id, name}) => {
      ownerListDiv.innerHTML += `
        <div class="badge bg-secondary p-2">
          ${name}
          <button class="btn-close btn-sm ms-2" onclick="removeOwner('${id}', '${name}')"></button>
        </div>`;
    });
  }

  // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤
  function renderTable() {
    const filter = document.getElementById("filterOwner").value;
    const tbody = document.getElementById("historyBody");
    tbody.innerHTML = "";

    const filteredData = filter === "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ? adHistory : adHistory.filter(e => e.owner === filter);

    let sumSpend = 0, sumCost = 0, sumPurchase = 0, sumRevenue = 0;

    filteredData.forEach((e, i) => {
      tbody.innerHTML += `
        <tr>
          <td>${e.date}</td>
          <td>${e.accountName}</td>
          <td>${e.accountId}</td>
          <td>${e.owner}</td>
          <td>${e.status || "-"}</td>
          <td>${parseFloat(e.spendTotal || 0).toFixed(2)}</td>
          <td>${parseFloat(e.costPerPurchase || 0).toFixed(2)}</td>
          <td>${parseInt(e.purchases || 0)}</td>
          <td>${parseFloat(e.revenue || 0).toFixed(2)}</td>
          <td>${parseFloat(e.roas || 0).toFixed(2)}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editEntry(${i})">‚úèÔ∏è</button>
            <button class="btn btn-sm btn-danger" onclick="deleteEntry(${i})">üóëÔ∏è</button>
          </td>
        </tr>`;
      sumSpend += parseFloat(e.spendTotal || 0);
      sumCost += parseFloat(e.costPerPurchase || 0);
      sumPurchase += parseInt(e.purchases || 0);
      sumRevenue += parseFloat(e.revenue || 0);
    });

    document.getElementById("sumSpend").textContent = sumSpend.toFixed(2);
    document.getElementById("avgCost").textContent = filteredData.length ? (sumCost / filteredData.length).toFixed(2) : "0.00";
    document.getElementById("sumPurchase").textContent = sumPurchase;
    document.getElementById("sumRevenue").textContent = sumRevenue.toFixed(2);
  }

  // ‡∏Å‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
  function editEntry(i) {
    const e = adHistory[i];
    document.getElementById("editIndex").value = i;
    document.getElementById("date").value = e.date;
    document.getElementById("accountName").value = e.accountName;
    document.getElementById("accountId").value = e.accountId;
    document.getElementById("owner").value = e.owner;
    document.getElementById("status").value = e.status;
    document.getElementById("spendTotal").value = e.spendTotal || "";
    document.getElementById("costPerPurchase").value = e.costPerPurchase || "";
    document.getElementById("purchases").value = e.purchases || "";
    document.getElementById("revenue").value = e.revenue || "";
    document.getElementById("roas").value = e.roas || "";
  }

  // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Supabase
  async function deleteEntry(i) {
    if (!confirm("‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) return;
    const id = adHistory[i].id;
    lastDeleted = adHistory[i];
    const { error } = await supabase.from("ad_history").delete().eq("id", id);
    if (error) {
      alert("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
      return;
    }
    document.getElementById("undoBtn").style.display = "inline-block";
    await fetchAdHistory();
  }

  // Undo ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  async function undoDelete() {
    if (!lastDeleted) return;
    const { error } = await supabase.from("ad_history").insert([lastDeleted]);
    if (error) {
      alert("‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
      return;
    }
    lastDeleted = null;
    document.getElementById("undoBtn").style.display = "none";
    await fetchAdHistory();
  }

  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà
  async function addOwner() {
    const name = document.getElementById("newOwner").value.trim();
    if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ");
    if (ownerList.some(o => o.name === name)) return alert("‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß");

    const { error } = await supabase.from("ad_owners").insert([{ name }]);
    if (error) {
      alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
      return;
    }
    document.getElementById("newOwner").value = "";
    await fetchOwnerList();
  }

  // ‡∏•‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
  async function removeOwner(id, name) {
    if (!confirm(`‡∏•‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ "${name}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
    const { error } = await supabase.from("ad_owners").delete().eq("id", id);
    if (error) {
      alert("‡∏•‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
      return;
    }
    await fetchOwnerList();
  }

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
  document.getElementById("adForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const editIdx = document.getElementById("editIndex").value;
    const entry = {
      date: document.getElementById("date").value,
      accountName: document.getElementById("accountName").value.trim(),
      accountId: document.getElementById("accountId").value.trim(),
      owner: document.getElementById("owner").value,
      status: document.getElementById("status").value,
      spendTotal: parseFloat(document.getElementById("spendTotal").value) || 0,
      costPerPurchase: parseFloat(document.getElementById("costPerPurchase").value) || 0,
      purchases: parseInt(document.getElementById("purchases").value) || 0,
      revenue: parseFloat(document.getElementById("revenue").value) || 0,
      roas: parseFloat(document.getElementById("roas").value) || 0,
    };

    if (!entry.date || !entry.accountName || !entry.accountId || !entry.owner) {
      return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
    }

    if (editIdx !== "") {
      // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      const id = adHistory[editIdx].id;
      const { error } = await supabase.from("ad_history").update(entry).eq("id", id);
      if (error) {
        alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
        return;
      }
    } else {
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
      const { error } = await supabase.from("ad_history").insert([entry]);
      if (error) {
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
        return;
      }
    }

    e.target.reset();
    document.getElementById("editIndex").value = "";
    await fetchAdHistory();
  });

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Owner
  document.getElementById("filterOwner").addEventListener("change", renderTable);

  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô global ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å onclick ‡πÉ‡∏ô HTML ‡πÑ‡∏î‡πâ
  window.addOwner = addOwner;
  window.removeOwner = removeOwner;
  window.deleteEntry = deleteEntry;
  window.undoDelete = undoDelete;
  window.editEntry = editEntry;

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
  fetchOwnerList();
  fetchAdHistory();
</script>
</body>
</html>
